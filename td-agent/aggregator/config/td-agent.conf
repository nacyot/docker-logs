<source>
  type forward
  port ::DATA_PORT::
  bind ::DATA_BIND::
</source>

<match logspout.**>
  type rewrite_tag_filter
  rewriterule1 container_name ^(.*)$ container.$1
</match>

<match container.**>
  type rewrite_tag_filter
  rewriterule1 event ^.*?:.*?\t.*$ raw.formatted.${tag}.ltsv
  rewriterule2 event .+ finish.formatted.${tag}.unmatch
</match>

### Process LTSV format start ###
<match raw.formatted.**.ltsv>
  type fields_parser
  parse_key event
  pattern ([^\t]+):([^\t]+)
  remove_tag_prefix raw
</match>

<match formatted.**.ltsv>
  type record_reformer
  remove_keys event
  tag finish.${tag}
</match>
### Process LTSV format end ###

<match finish.**>
  type forest
  subtype elasticsearch
  <template>
    type_name ${tag_parts[3]}
    type elasticsearch
    host ::ES_HOST::
    port ::ES_PORT::
    logstash_format true
    flush_interval ::FLUSH_INTERVAL::
  </template>
</match>

